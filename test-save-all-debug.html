<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save All Debug Test</title>
    <link rel="stylesheet" href="css/admin-dashboard.css">
</head>
<body>
    <div style="padding: 20px;">
        <h1>Save All Button Debug Test</h1>
        <p>This test page will help debug the Save All button functionality.</p>
        
        <div id="debug-info">
            <h2>Debug Information</h2>
            <div id="debug-output"></div>
        </div>
        
        <!-- Mock Save All button for testing -->
        <button id="save-all-btn" class="action-btn save-btn">
            üíæ Save All (Debug)
        </button>
        
        <div id="test-results"></div>
    </div>

    <!-- Load the admin dashboard script -->
    <script src="js/admin-dashboard.js"></script>
    
    <script>
        // Debug script to test Save All functionality
        document.addEventListener('DOMContentLoaded', function() {
            const debugOutput = document.getElementById('debug-output');
            const testResults = document.getElementById('test-results');
            
            function log(message) {
                console.log(message);
                debugOutput.innerHTML += '<div>' + message + '</div>';
            }
            
            log('Starting Save All Debug Test...');
            
            // Check if AdminDashboard class exists
            if (typeof AdminDashboard !== 'undefined') {
                log('‚úÖ AdminDashboard class found');
                
                // Create instance and test
                const dashboard = new AdminDashboard();
                
                // Mock some data
                dashboard.currentCategory = 'coop';
                dashboard.currentData = [
                    { name: 'Test Game 1', copies: 1, 'COMPLETED?': 'No' },
                    { name: 'Test Game 2', copies: 0, 'COMPLETED?': 'No' }
                ];
                
                log('‚úÖ Mock data set');
                log('Current modifiedItems size: ' + dashboard.modifiedItems.size);
                
                // Simulate modifying an item
                dashboard.markAsModified(0);
                log('After marking item 0 as modified: ' + dashboard.modifiedItems.size);
                
                // Test saveAllChanges
                testResults.innerHTML = '<h3>Testing saveAllChanges()...</h3>';
                
                // Override console methods to capture output
                const originalConsoleLog = console.log;
                const originalConsoleError = console.error;
                let capturedLogs = [];
                
                console.log = function(...args) {
                    capturedLogs.push('LOG: ' + args.join(' '));
                    originalConsoleLog.apply(console, args);
                };
                
                console.error = function(...args) {
                    capturedLogs.push('ERROR: ' + args.join(' '));
                    originalConsoleError.apply(console, args);
                };
                
                // Test the save function
                dashboard.saveAllChanges().then(() => {
                    // Restore console methods
                    console.log = originalConsoleLog;
                    console.error = originalConsoleError;
                    
                    testResults.innerHTML += '<h4>Captured Logs:</h4>';
                    capturedLogs.forEach(log => {
                        testResults.innerHTML += '<div>' + log + '</div>';
                    });
                    
                    testResults.innerHTML += '<h4>Final State:</h4>';
                    testResults.innerHTML += '<div>modifiedItems size: ' + dashboard.modifiedItems.size + '</div>';
                    
                }).catch(error => {
                    // Restore console methods
                    console.log = originalConsoleLog;
                    console.error = originalConsoleError;
                    
                    testResults.innerHTML += '<div style="color: red;">Error: ' + error.message + '</div>';
                    capturedLogs.forEach(log => {
                        testResults.innerHTML += '<div>' + log + '</div>';
                    });
                });
                
            } else {
                log('‚ùå AdminDashboard class not found');
            }
        });
    </script>
</body>
</html>
