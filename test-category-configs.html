<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Configuration Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #1a1a2e;
            color: white;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #444; 
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
        }
        .test-result { 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 4px; 
        }
        .success { background: rgba(0,255,0,0.2); border: 1px solid green; }
        .error { background: rgba(255,0,0,0.2); border: 1px solid red; }
        .info { background: rgba(0,150,255,0.2); border: 1px solid #0096ff; }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 10px 0; 
        }
        th, td { 
            border: 1px solid #444; 
            padding: 8px; 
            text-align: left; 
        }
        th { background: rgba(255,255,255,0.1); }
        .check-pass { color: #4ade80; }
        .check-fail { color: #f87171; }
    </style>
</head>
<body>
    <h1>🧪 Category Configuration Validation Test</h1>
    
    <div class="test-section">
        <h2>Data Structure vs Configuration Match Test</h2>
        <div id="validation-test"></div>
    </div>

    <script>
        // Updated category configurations from admin-dashboard.js
        const categoryConfigs = {
            movies: {
                fields: ['STATUS', 'WATCHED'],
                timesSeenField: 'WATCHED',
                watchedField: 'WATCHED',
                showCopies: false
            },
            anime: {
                fields: ['STATUS', 'LAST WATCHED', 'Series Length'],
                lastWatchedField: 'LAST WATCHED',
                seriesLengthField: 'Series Length',
                showCopies: false
            },
            youtube: {
                fields: ['STATUS', 'WATCHED'],
                timesSeenField: 'WATCHED',
                watchedField: 'WATCHED',
                showCopies: false
            },
            singleplayer: {
                fields: ['STATUS', 'COMPLETED?', 'TIME TO BEAT'],
                completedField: 'COMPLETED?',
                timeField: 'TIME TO BEAT',
                showCopies: false
            },
            coop: {
                fields: ['text', 'copies', 'game', 'genre'],
                textField: 'text',
                copiesField: 'copies',
                gameField: 'game',
                genreField: 'genre',
                showCopies: true
            },
            pvp: {
                fields: ['text', 'copies', 'game', 'genre'],
                textField: 'text',
                copiesField: 'copies',
                gameField: 'game', 
                genreField: 'genre',
                showCopies: true
            },
            loot: {
                fields: ['text', 'copies', 'cost', 'genre'],
                copiesField: 'copies',
                costField: 'cost',
                textField: 'text',
                genreField: 'genre',
                showCopies: true
            },
            sundaymorning: {
                fields: ['STATUS', 'LAST WATCHED', 'Series Length'],
                lastWatchedField: 'LAST WATCHED',
                seriesLengthField: 'Series Length',
                showCopies: false
            },
            sundaynight: {
                fields: ['STATUS', 'LAST WATCHED', 'Series Length'],
                lastWatchedField: 'LAST WATCHED',
                seriesLengthField: 'Series Length',
                showCopies: false
            }
        };

        // Mock data structures based on actual JSON files
        const mockDataStructures = {
            movies: {
                "Title": "65 (2023)",
                "STATUS": "",
                "WATCHED": "👀",
                "OwnerShip": "HULU",
                "GENRE": "SyFy, Action & Adventure, Mystery & Thriller"
            },
            anime: {
                "LINK": "https://www.crunchyroll.com/series/GY8VEQ95Y/dragon-ball-daima",
                "GENRE": "Action, Adventure, Comedy, Fantasy, Martial Arts, Shounen, Super Power",
                "TITLE": "Dragon Ball DAIMA",
                "STATUS": "🟢",
                "LAST WATCHED": "ep3",
                "Series Length": "20 episodes",
                "Max Episodes": "20 weeks, 20 episodes"
            },
            youtube: {
                "Link": "http://www.youtube.com/watch?v=nBI1WCmHRe4",
                "GENRE": "Documentary",
                "TITLE": "Ozempic - What's the truth behind the hype?",
                "STATUS": "🟢",
                "TIMES SEEN": "👀"
            },
            singleplayer: {
                "LINK": "https://www.igdb.com/games/shady-part-of-me",
                "GENRE": "Platform, Puzzle, Role-playing (RPG), Adventure, Indie",
                "TITLE": "Shady Part of Me",
                "STATUS": "🟢",
                "COMPLETED?": "",
                "TIME TO BEAT": "5hrs"
            },
            coop: {
                "text": "EtchWraith Swarm",
                "game": "ERGOarena",
                "details": "EtchWraith Swarm Attacks!",
                "copies": 23,
                "genre": "ERGOvillians",
                "mode": "ERGOarena"
            },
            pvp: {
                "game": "ERGOarena",
                "text": "CyberBadger Cete",
                "genre": "ERGOvillians",
                "copies": 21,
                "mode": "ERGOarena"
            },
            loot: {
                "id": 1,
                "text": "Test Updated Item",
                "copies": 7,
                "details": "Updated test item",
                "genre": "test",
                "type": "loot",
                "cost": 0
            },
            sundaymorning: {
                "LINK": "https://www.crunchyroll.com/series/GRMG8ZQZR/one-piece",
                "GENRE": "Action, Adventure, Comedy, Drama, Fantasy, Shounen, Super Power",
                "TITLE": "One Piece",
                "STATUS": "🟢",
                "LAST WATCHED": "ep1085",
                "Series Length": "1085+ episodes",
                "Max Episodes": "52 weeks, 1085+ episodes"
            },
            sundaynight: {
                "LINK": "https://www.crunchyroll.com/series/GRMG8ZQZR/one-piece",
                "GENRE": "Action, Adventure, Comedy, Drama, Fantasy, Shounen, Super Power",
                "TITLE": "One Piece",
                "STATUS": "🟢",
                "LAST WATCHED": "ep1085",
                "Series Length": "1085+ episodes",
                "Max Episodes": "52 weeks, 1085+ episodes"
            }
        };

        function validateConfigurations() {
            const validationDiv = document.getElementById('validation-test');
            let html = '<h3>Configuration Validation Results:</h3>';
            
            html += `<table>
                <tr>
                    <th>Category</th>
                    <th>Expected Fields</th>
                    <th>Available in Data</th>
                    <th>Status</th>
                    <th>Issues</th>
                </tr>
            `;
            
            for (const [category, config] of Object.entries(categoryConfigs)) {
                const mockData = mockDataStructures[category];
                const availableFields = mockData ? Object.keys(mockData) : [];
                const expectedFields = config.fields || [];
                
                let missingFields = [];
                let extraConfigFields = [];
                
                // Check if all configured fields exist in the data
                expectedFields.forEach(field => {
                    if (!availableFields.includes(field)) {
                        missingFields.push(field);
                    }
                });
                
                // Check if there are configured field references that don't exist
                const allConfigFields = [
                    config.textField,
                    config.copiesField,
                    config.gameField,
                    config.genreField,
                    config.completedField,
                    config.timesSeenField,
                    config.lastWatchedField,
                    config.seriesLengthField,
                    config.timeField,
                    config.costField
                ].filter(Boolean);
                
                allConfigFields.forEach(field => {
                    if (!availableFields.includes(field) && !expectedFields.includes(field)) {
                        extraConfigFields.push(field);
                    }
                });
                
                const hasIssues = missingFields.length > 0 || extraConfigFields.length > 0;
                const statusClass = hasIssues ? 'check-fail' : 'check-pass';
                const statusIcon = hasIssues ? '❌' : '✅';
                
                let issues = [];
                if (missingFields.length > 0) {
                    issues.push(`Missing: ${missingFields.join(', ')}`);
                }
                if (extraConfigFields.length > 0) {
                    issues.push(`Extra config: ${extraConfigFields.join(', ')}`);
                }
                
                html += `
                    <tr>
                        <td><strong>${category}</strong></td>
                        <td>${expectedFields.join(', ')}</td>
                        <td>${availableFields.slice(0, 5).join(', ')}${availableFields.length > 5 ? '...' : ''}</td>
                        <td class="${statusClass}">${statusIcon}</td>
                        <td>${issues.join('; ') || 'None'}</td>
                    </tr>
                `;
            }
            
            html += '</table>';
            
            // Summary
            const totalCategories = Object.keys(categoryConfigs).length;
            const validCategories = Object.entries(categoryConfigs).filter(([category, config]) => {
                const mockData = mockDataStructures[category];
                const availableFields = mockData ? Object.keys(mockData) : [];
                const expectedFields = config.fields || [];
                return expectedFields.every(field => availableFields.includes(field));
            }).length;
            
            html += `
                <div class="test-result ${validCategories === totalCategories ? 'success' : 'error'}">
                    <h4>Summary: ${validCategories}/${totalCategories} categories properly configured</h4>
                    ${validCategories === totalCategories ? 
                        '🎉 All category configurations match their data structures!' : 
                        '⚠️ Some categories need configuration updates.'
                    }
                </div>
            `;
            
            validationDiv.innerHTML = html;
        }

        // Initialize test
        document.addEventListener('DOMContentLoaded', () => {
            validateConfigurations();
        });
    </script>
</body>
</html>
