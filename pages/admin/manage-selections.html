<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Selections - ErgoSphere Admin</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22black%22/><circle cx=%2280%22 cy=%2220%22 r=%2212%22 fill=%22lime%22 opacity=%220.4%22/><circle cx=%2275%22 cy=%2225%22 r=%228%22 fill=%22lime%22/><circle cx=%2220%22 cy=%2280%22 r=%2212%22 fill=%22purple%22 opacity=%220.4%22/><circle cx=%2225%22 cy=%2275%22 r=%228%22 fill=%22purple%22/></svg>" />
  <style>
    .admin-form {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #0ff;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #0ff;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      border-radius: 4px;
    }
    
    .form-group select {
      height: 36px;
    }
    
    .submit-btn {
      background-color: #f0f;
      border: none;
      color: white;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 10px;
      transition: all 0.3s;
    }
    
    .submit-btn:hover {
      background-color: #d0d;
      transform: translateY(-2px);
    }
    
    .notification {
      padding: 10px;
      margin: 15px 0;
      border-radius: 4px;
      display: none;
    }
    
    .success {
      background-color: rgba(0, 255, 0, 0.2);
      border: 1px solid #0f0;
      color: #0f0;
    }
    
    .error {
      background-color: rgba(255, 0, 0, 0.2);
      border: 1px solid #f00;
      color: #f00;
    }

    .preview-card {
      border: 1px solid #0ff;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 5px;
      padding: 15px;
      margin-top: 20px;
    }
    
    .preview-title {
      color: #0ff;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
      margin-bottom: 10px;
    }
      .preview-content {
      color: white;
      text-align: center;
      font-size: 1.2em;
    }
    
    .last-updated {
      font-size: 0.9em;
      color: #888;
      margin-top: 20px;
      border-top: 1px solid rgba(0,255,255,0.2);
      padding-top: 10px;
    }

    @keyframes pulse {
      0% { background-color: rgba(255, 255, 255, 0.1); }
      50% { background-color: rgba(255, 255, 255, 0.3); }
      100% { background-color: rgba(255, 255, 255, 0.1); }
    }

    .end-date-warning {
      animation: pulse 1.5s infinite;
      color: #f00;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <script src="../../js/weekly-choices.js"></script>
  <nav id="navbar">
    <button><a href="../../index.html">HOME</a></button>
    <button><a href="../ErgoShop.html">ErgoShop</a></button>
    <button><a href="../MODS.html">MODS</a></button>
    <button><a href="../casino.html">CASINO</a></button>
    <button><a href="../scoreboard.html">SCOREBOARD</a></button>
    <button><a href="../contracts.html">CONTRACTS</a></button>
  </nav>

  <hr>
  <header>
    <h1>ErgoSphere Admin</h1>
  </header>
  <hr>

  <main id="main-content">
    <div class="cyber-panel admin-form">
      <h2 class="cyber-title">Manage Weekly Selections</h2>
      
      <div id="notification" class="notification"></div>
      
      <form id="selectionsForm">        <div class="form-group">
          <label for="bingwaChampion">Bingwa Champion:</label>
          <select id="bingwaChampion" name="bingwaChampion" required>
            <option value="N/A">N/A</option>
            <option value="JAYBERS8">JAYBERS8</option>
            <option value="FLIGHTx12!">FLIGHTx12!</option>
          </select>
        </div>
          <div class="form-group">
          <label for="atleticoChamp">Atletico Champion:</label>
          <select id="atleticoChamp" name="atleticoChamp" required>
            <option value="N/A">N/A</option>
            <option value="FLIGHTx12!">FLIGHTx12!</option>
            <option value="JAYBERS8">JAYBERS8</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="movieNight">Movie Night Selection:</label>
          <select id="movieNight" name="movieNight" required>
            <option value="Loading...">Loading...</option>
          </select>
        </div>
          <div class="form-group">
          <label for="banquetMeal">Bingwa Banquet Meal:</label>
          <select id="banquetMeal" name="banquetMeal" required>
            <option value="Loading...">Loading...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="bingwaBrunch">Bingwa Brunch:</label>
          <select id="bingwaBrunch" name="bingwaBrunch" required>
            <option value="Loading...">Loading...</option>
          </select>
        </div>
        
        <div class="form-group section-separator">
          <h3>Weekly Choices</h3>
        </div>
        
        <div class="form-group">
          <label for="nextBingwaChallenge">Next Week's BINGWA Challenge:</label>
          <select id="nextBingwaChallenge" name="nextBingwaChallenge">
            <option value="Loading...">Loading...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="atleticoWorkout">ATLETICO Workout:</label>
          <select id="atleticoWorkout" name="atleticoWorkout">
            <option value="Loading...">Loading...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="weeklyErrand">Weekly Errand:</label>
          <select id="weeklyErrand" name="weeklyErrand">
            <option value="Loading...">Loading...</option>
          </select>
        </div><div class="form-group">
          <label for="youtubeTheater1">YouTube Theater Selection:</label>
          <select id="youtubeTheater1" name="youtubeTheater1" required>
            <option value="">-- Select Video 1 --</option>
          </select>
          <select id="youtubeTheater2" name="youtubeTheater2">
            <option value="">-- Select Video 2 (optional) --</option>
          </select>
          <select id="youtubeTheater3" name="youtubeTheater3">
            <option value="">-- Select Video 3 (optional) --</option>
          </select>
          <div id="youtube-runtime-warning" style="color:#f00; display:none; font-size:0.95em; margin-top:4px;"></div>
        </div>
        
        <div class="form-group">
          <label for="animeSelection">Anime Selection:</label>
          <select id="animeSelection" name="animeSelection" required>
            <option value="">-- Select Anime --</option>
          </select>
          <label for="animeEndDate">End Date:</label>
          <input type="date" id="animeEndDate" name="animeEndDate">
        </div>
        <div class="form-group">
          <label for="sundayMorningSelection">Sunday Morning Cinema:</label>
          <select id="sundayMorningSelection" name="sundayMorningSelection" required>
            <option value="">-- Select Show --</option>
          </select>
          <label for="sundayMorningEndDate">End Date:</label>
          <input type="date" id="sundayMorningEndDate" name="sundayMorningEndDate">
        </div>
        <div class="form-group">
          <label for="sundayNightSelection">Sunday Night:</label>
          <select id="sundayNightSelection" name="sundayNightSelection" required>
            <option value="">-- Select Show --</option>
          </select>
          <label for="sundayNightEndDate">End Date:</label>
          <input type="date" id="sundayNightEndDate" name="sundayNightEndDate">
        </div>
        
        <div class="form-group section-separator">
          <h3>Quarterly Games & Art</h3>
        </div>
        
        <div class="form-group">
          <label for="q1Game">Q1 Game (Jan-Mar):</label>
          <select id="q1Game" name="q1Game">
            <option value="">-- Select Q1 Game --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="q2Game">Q2 Game (Apr-Jun):</label>
          <select id="q2Game" name="q2Game">
            <option value="">-- Select Q2 Game --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="q3Game">Q3 Game (Jul-Sep):</label>
          <select id="q3Game" name="q3Game">
            <option value="">-- Select Q3 Game --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="q4Game">Q4 Game (Oct-Dec):</label>
          <select id="q4Game" name="q4Game">
            <option value="">-- Select Q4 Game --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="ergoArtSubject">ErgoArt Subject:</label>
          <input type="text" id="ergoArtSubject" name="ergoArtSubject" placeholder="Enter current ErgoArt subject">
        </div>
        
        <button type="submit" class="submit-btn">Update Selections</button>        <div class="preview-card">
          <div class="preview-title">Preview</div>        <div class="preview-content">
            <p><strong>Bingwa Champion:</strong> <span id="preview-bingwa"></span></p>
            <p><strong>Atletico Champion:</strong> <span id="preview-atletico"></span></p>
            <p><strong>Movie Night:</strong> <span id="preview-movie"></span></p>
            <p><strong>Bingwa Banquet:</strong> <span id="preview-banquet"></span></p>
            <p><strong>Bingwa Brunch:</strong> <span id="preview-brunch"></span></p>
            <p><strong>YouTube Theater:</strong> <span id="preview-youtube"></span></p>
            <p><strong>Anime:</strong> <span id="preview-anime"></span></p>
            <p><strong>Sunday Morning Cinema:</strong> <span id="preview-sunday-morning"></span></p>
            <p><strong>Sunday Night:</strong> <span id="preview-sunday-night"></span></p>
            <hr>
            <p><strong>Next Bingwa Challenge:</strong> <span id="preview-next-bingwa"></span></p>
            <p><strong>Atletico Workout:</strong> <span id="preview-atletico-workout"></span></p>
            <p><strong>Weekly Errand:</strong> <span id="preview-weekly-errand"></span></p>
            <hr>
            <p><strong>Q1 Game:</strong> <span id="preview-q1game"></span></p>
            <p><strong>Q2 Game:</strong> <span id="preview-q2game"></span></p>
            <p><strong>Q3 Game:</strong> <span id="preview-q3game"></span></p>
            <p><strong>Q4 Game:</strong> <span id="preview-q4game"></span></p>
            <p><strong>ErgoArt Subject:</strong> <span id="preview-ergoart"></span></p>
            <p class="last-updated"><em>Last updated: <span id="last-updated">Never</span></em></p>
          </div>
        </div>
      </form>
    </div>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Load singleplayer games for quarterly game dropdowns
      fetch('../../data/singleplayer.json')
        .then(response => {
          return response.text().then(text => {
            const jsonString = text.replace(/^\s*\/\/.*$/gm, '');
            try {
              return JSON.parse(jsonString);
            } catch (e) {
              console.error('Error parsing singleplayer JSON:', e);
              throw e;
            }
          });
        })
        .then(data => {
          const q1Select = document.getElementById('q1Game');
          const q2Select = document.getElementById('q2Game');
          const q3Select = document.getElementById('q3Game');
          const q4Select = document.getElementById('q4Game');
          
          const quarterlySelects = [q1Select, q2Select, q3Select, q4Select];
          
          // Clear the loading options
          quarterlySelects.forEach(select => {
            select.innerHTML = '<option value="">-- Select Game --</option>';
          });
          
          // Add all singleplayer games to the quarterly game dropdowns
          data.forEach(game => {
            if (game.TITLE || game.Title) {
              const title = game.TITLE || game.Title;
              quarterlySelects.forEach(select => {
                const option = document.createElement('option');
                option.value = title;
                option.textContent = title + (game.STATUS ? ` ${game.STATUS}` : '');
                select.appendChild(option);
              });
            }
          });
        })
        .catch(error => {
          console.error('Error loading singleplayer games:', error);
        });
      
      // Load movie options from movies.json
      fetch('../../data/movies.json')
        .then(response => {
          // Remove comments from JSON file if they exist
          return response.text().then(text => {
            // Remove any comments that start with //
            const jsonString = text.replace(/^\s*\/\/.*$/gm, '');
            try {
              return JSON.parse(jsonString);
            } catch (e) {
              console.error('Error parsing JSON:', e);
              throw e;
            }
          });
        })        .then(data => {
          const movieSelect = document.getElementById('movieNight');
          // Clear the loading option
          movieSelect.innerHTML = '';
          
          // Add N/A option first
          const naOption = document.createElement('option');
          naOption.value = "N/A";
          naOption.textContent = "N/A";
          movieSelect.appendChild(naOption);
          
          // Add only movies with STATUS of 游릭 to the select dropdown
          data.forEach(movie => {
            if (movie.Title && movie.STATUS === "游릭") {
              const option = document.createElement('option');
              option.value = movie.Title;
              option.textContent = movie.Title;
              movieSelect.appendChild(option);
            }
          });
          
          // Now load meal options from meals.json
          return fetch('../../data/meals.json');
        })
        .then(response => {
          return response.text().then(text => {
            const jsonString = text.replace(/^\s*\/\/.*$/gm, '');
            try {
              return JSON.parse(jsonString);
            } catch (e) {
              console.error('Error parsing meals JSON:', e);
              throw e;
            }
          });
        })
        .then(data => {          const banquetSelect = document.getElementById('banquetMeal');
          const brunchSelect = document.getElementById('bingwaBrunch');
          // Clear the loading option
          banquetSelect.innerHTML = '';
          brunchSelect.innerHTML = '';
          
          // Add N/A option first to banquet dropdown
          const naOptionBanquet = document.createElement('option');
          naOptionBanquet.value = "N/A";
          naOptionBanquet.textContent = "N/A";
          banquetSelect.appendChild(naOptionBanquet);
          
          // Add N/A option first to brunch dropdown
          const naOptionBrunch = document.createElement('option');
          naOptionBrunch.value = "N/A";
          naOptionBrunch.textContent = "N/A";
          brunchSelect.appendChild(naOptionBrunch);
          
          // Add all meal options to the banquet dropdown
          data.forEach(meal => {
            const option = document.createElement('option');
            option.value = meal.meal;
            option.textContent = meal.meal;
            banquetSelect.appendChild(option);
          });
          // Add only Bingwa Brunch options to the brunch dropdown
          data.filter(meal => meal.mealType === 'bingwa_brunch').forEach(meal => {
            const option = document.createElement('option');
            option.value = meal.meal;
            option.textContent = meal.meal;
            brunchSelect.appendChild(option);
          });
          // Now load YouTube options from youtube.json
          return fetch('../../data/youtube.json');
        })
        .then(response => {
          return response.text().then(text => {
            const jsonString = text.replace(/^\s*\/\/.*$/gm, '');
            try {
              return JSON.parse(jsonString);
            } catch (e) {
              console.error('Error parsing youtube JSON:', e);
              throw e;
            }
          });
        })
        .then(data => {
          const yt1 = document.getElementById('youtubeTheater1');
          const yt2 = document.getElementById('youtubeTheater2');
          const yt3 = document.getElementById('youtubeTheater3');
          [yt1, yt2, yt3].forEach(select => {
            select.innerHTML = `<option value="">-- Select Video${select === yt1 ? ' 1' : select === yt2 ? ' 2 (optional)' : ' 3 (optional)'} --</option>`;
            data.forEach(video => {
              if (video.TITLE && video.STATUS === '游릭') {
                const option = document.createElement('option');
                let label = video.TITLE + (video.RUNTIME ? ` (${video.RUNTIME})` : '');
                if (video["TIMES SEEN"] && video["TIMES SEEN"].includes('游')) {
                  label += ' 游';
                }
                option.value = video.TITLE;
                option.textContent = label;
                option.setAttribute('data-runtime', video.RUNTIME || '0:00');
                select.appendChild(option);
              }
            });
          });
          // Load anime options from anime.json (only active)
      fetch('../../data/anime.json')
        .then(response => response.json())
        .then(data => {
          const animeSelect = document.getElementById('animeSelection');
          animeSelect.innerHTML = '<option value="">-- Select Anime --</option>';
          data.forEach(anime => {
            if (anime.TITLE && anime.STATUS === '游릭') {
              const option = document.createElement('option');
              option.value = anime.TITLE;
              option.textContent = anime.TITLE;
              animeSelect.appendChild(option);
            }
          });
        });
      // Load Sunday Morning Cinema options (only active)
      fetch('../../data/sundaymorning.json')
        .then(response => response.json())
        .then(data => {
          const smSelect = document.getElementById('sundayMorningSelection');
          smSelect.innerHTML = '<option value="">-- Select Show --</option>';
          data.forEach(show => {
            if (show.TITLE && show.STATUS === '游릭') {
              const option = document.createElement('option');
              option.value = show.TITLE;
              option.textContent = show.TITLE;
              smSelect.appendChild(option);
            }
          });
        });
      // Load Sunday Night options (only active)
      fetch('../../data/sundaynight.json')
        .then(response => response.json())
        .then(data => {
          const snSelect = document.getElementById('sundayNightSelection');
          snSelect.innerHTML = '<option value="">-- Select Show --</option>';
          data.forEach(show => {
            if (show.TITLE && show.STATUS === '游릭') {
              const option = document.createElement('option');
              option.value = show.TITLE;
              option.textContent = show.TITLE;
              snSelect.appendChild(option);
            }
          });
        });
          loadCurrentSelections();
        })
        .catch(error => {
          console.error('Error loading data:', error);
          document.getElementById('movieNight').innerHTML = '<option value="Error">Error loading movies</option>';
          document.getElementById('banquetMeal').innerHTML = '<option value="Error">Error loading meals</option>';
        });        // Form submission
      document.getElementById('selectionsForm').addEventListener('submit', function(e) {
        e.preventDefault();
          const bingwaChampion = document.getElementById('bingwaChampion').value;
        const atleticoChamp = document.getElementById('atleticoChamp').value;
        const movieNight = document.getElementById('movieNight').value;
        const banquetMeal = document.getElementById('banquetMeal').value;
        const brunchMeal = document.getElementById('bingwaBrunch').value;
        const youtubeTheater = [
          document.getElementById('youtubeTheater1').value,
          document.getElementById('youtubeTheater2').value,
          document.getElementById('youtubeTheater3').value
        ].filter(Boolean);
        
        // Get Weekly Choices
        const nextBingwaChallenge = document.getElementById('nextBingwaChallenge').value;
        const atleticoWorkout = document.getElementById('atleticoWorkout').value;
        const weeklyErrand = document.getElementById('weeklyErrand').value;
        
        // Get quarterly games
        const quarterlyGames = {
          q1: document.getElementById('q1Game').value,
          q2: document.getElementById('q2Game').value,
          q3: document.getElementById('q3Game').value,
          q4: document.getElementById('q4Game').value
        };
        
        // Get ErgoArt subject
        const ergoArtSubject = document.getElementById('ergoArtSubject').value;
        
        // Add Anime, Sunday Morning, Sunday Night to POST body
        const animeSelection = document.getElementById('animeSelection').value;
        const animeEndDate = document.getElementById('animeEndDate').value || null;
        const sundayMorningSelection = document.getElementById('sundayMorningSelection').value;
        const sundayMorningEndDate = document.getElementById('sundayMorningEndDate').value || null;
        const sundayNightSelection = document.getElementById('sundayNightSelection').value;
        const sundayNightEndDate = document.getElementById('sundayNightEndDate').value || null;
        
        // Show loading state
        const submitBtn = this.querySelector('.submit-btn');
        const originalBtnText = submitBtn.textContent;
        submitBtn.textContent = 'Saving...';
        submitBtn.disabled = true;
          if (!checkYouTubeRuntimeLimit()) {
          e.preventDefault();
          return;
        }
        
        // Update server via API
        fetch('/api/selections', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            bingwaChampion,
            atleticoChamp,
            movieNight,
            banquetMeal,
            brunchMeal,
            youtubeTheater,
            quarterlyGames,
            ergoArtSubject,
            nextBingwaChallenge,
            atleticoWorkout,
            weeklyErrand,
            anime: animeSelection,
            animeEndDate,
            sundayMorning: sundayMorningSelection,
            sundayMorningEndDate,
            sundayNight: sundayNightSelection,
            sundayNightEndDate
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          showNotification('Selections updated successfully!', 'success');
          updatePreview();
          
          // Reset button state
          submitBtn.textContent = originalBtnText;
          submitBtn.disabled = false;
        })
        .catch(error => {
          console.error('Error updating selections:', error);
          showNotification('Error updating selections. Please try again.', 'error');
          
          // Reset button state
          submitBtn.textContent = originalBtnText;
          submitBtn.disabled = false;
        });
      });      // Update preview when selection changes      document.getElementById('bingwaChampion').addEventListener('change', updatePreview);
      document.getElementById('atleticoChamp').addEventListener('change', updatePreview);
      document.getElementById('movieNight').addEventListener('change', updatePreview);
      document.getElementById('banquetMeal').addEventListener('change', updatePreview);
      document.getElementById('bingwaBrunch').addEventListener('change', updatePreview);
      
      // Add event listeners for Weekly Choices
      document.getElementById('nextBingwaChallenge').addEventListener('change', updatePreview);
      document.getElementById('atleticoWorkout').addEventListener('change', updatePreview);
      document.getElementById('weeklyErrand').addEventListener('change', updatePreview);
      
      // Add event listeners for Anime, Sunday Morning, Sunday Night and their end dates
      document.getElementById('animeSelection').addEventListener('change', updatePreview);
      document.getElementById('animeEndDate').addEventListener('change', updatePreview);
      document.getElementById('sundayMorningSelection').addEventListener('change', updatePreview);
      document.getElementById('sundayMorningEndDate').addEventListener('change', updatePreview);
      document.getElementById('sundayNightSelection').addEventListener('change', updatePreview);
      document.getElementById('sundayNightEndDate').addEventListener('change', updatePreview);
      
      // Add event listeners for quarterly games and ErgoArt subject
      document.getElementById('q1Game').addEventListener('change', updatePreview);
      document.getElementById('q2Game').addEventListener('change', updatePreview);
      document.getElementById('q3Game').addEventListener('change', updatePreview);
      document.getElementById('q4Game').addEventListener('change', updatePreview);
      document.getElementById('ergoArtSubject').addEventListener('change', updatePreview);
      
      ['youtubeTheater1','youtubeTheater2','youtubeTheater3'].forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
          updatePreview();
          checkYouTubeRuntimeLimit();
          updateYouTubeDropdowns();
        });
      });      function loadCurrentSelections() {
        // Fetch current selections from server
        fetch('/api/selections')
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then(ergosphereData => {
            console.log('Loaded selections data:', ergosphereData);
            
            // Populate fields with current values
            // Quarterly games
            if (ergosphereData.quarterlyGames) {
              if (ergosphereData.quarterlyGames.q1 && !ergosphereData.quarterlyGames.q1.includes('No Q1 Game')) {
                document.getElementById('q1Game').value = ergosphereData.quarterlyGames.q1;
              } else {
                document.getElementById('q1Game').value = '';
              }
              if (ergosphereData.quarterlyGames.q2 && !ergosphereData.quarterlyGames.q2.includes('No Q2 Game')) {
                document.getElementById('q2Game').value = ergosphereData.quarterlyGames.q2;
              } else {
                document.getElementById('q2Game').value = '';
              }
              if (ergosphereData.quarterlyGames.q3 && !ergosphereData.quarterlyGames.q3.includes('No Q3 Game')) {
                document.getElementById('q3Game').value = ergosphereData.quarterlyGames.q3;
              } else {
                document.getElementById('q3Game').value = '';
              }              if (ergosphereData.quarterlyGames.q4 && !ergosphereData.quarterlyGames.q4.includes('No Q4 Game')) {
                document.getElementById('q4Game').value = ergosphereData.quarterlyGames.q4;
              } else {
                document.getElementById('q4Game').value = '';
              }
            }
            
            // Load ErgoArt subject if available
            if (ergosphereData.ergoArtSubject) {
              document.getElementById('ergoArtSubject').value = ergosphereData.ergoArtSubject;
            }
            
            if (ergosphereData.bingwaChampion) {
              document.getElementById('bingwaChampion').value = ergosphereData.bingwaChampion;
            }
            
            if (ergosphereData.atleticoChamp) {
              document.getElementById('atleticoChamp').value = ergosphereData.atleticoChamp;
            }
            
            if (ergosphereData.movieNight) {
              const movieSelect = document.getElementById('movieNight');
              // Try to find and select the stored movie
              let found = false;
              
              for (let i = 0; i < movieSelect.options.length; i++) {
                if (movieSelect.options[i].value === ergosphereData.movieNight) {
                  movieSelect.value = ergosphereData.movieNight;
                  found = true;
                  break;
                }
              }
              
              // If not found, add it as an option
              if (!found && ergosphereData.movieNight) {
                const option = document.createElement('option');
                option.value = ergosphereData.movieNight;
                option.textContent = ergosphereData.movieNight;
                movieSelect.appendChild(option);
                movieSelect.value = ergosphereData.movieNight;
              }
            }

            // Handle banquet meal selection
            if (ergosphereData.banquetMeal) {
              const banquetSelect = document.getElementById('banquetMeal');
              let found = false;
              
              for (let i = 0; i < banquetSelect.options.length; i++) {
                if (banquetSelect.options[i].value === ergosphereData.banquetMeal) {
                  banquetSelect.value = ergosphereData.banquetMeal;
                  found = true;
                  break;
                }
              }
              
              // If not found, add it as an option
              if (!found && ergosphereData.banquetMeal) {
                const option = document.createElement('option');
                option.value = ergosphereData.banquetMeal;
                option.textContent = ergosphereData.banquetMeal;
                banquetSelect.appendChild(option);
                banquetSelect.value = ergosphereData.banquetMeal;
              }
            }

            // Handle brunch meal selection
            if (ergosphereData.brunchMeal) {
              const brunchSelect = document.getElementById('bingwaBrunch');
              let found = false;
              
              for (let i = 0; i < brunchSelect.options.length; i++) {
                if (brunchSelect.options[i].value === ergosphereData.brunchMeal) {
                  brunchSelect.value = ergosphereData.brunchMeal;
                  found = true;
                  break;
                }
              }
              
              // If not found, add it as an option
              if (!found && ergosphereData.brunchMeal) {
                const option = document.createElement('option');
                option.value = ergosphereData.brunchMeal;
                option.textContent = ergosphereData.brunchMeal;
                brunchSelect.appendChild(option);
                brunchSelect.value = ergosphereData.brunchMeal;
              }
            }

            // Handle YouTube Theater selection
            if (ergosphereData.youtubeTheater) {
              const yt1 = document.getElementById('youtubeTheater1');
              const yt2 = document.getElementById('youtubeTheater2');
              const yt3 = document.getElementById('youtubeTheater3');
              const selected = ergosphereData.youtubeTheater;
              [yt1, yt2, yt3].forEach((select, idx) => {
                if (selected[idx]) {
                  let found = false;
                  for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === selected[idx]) {
                      select.value = selected[idx];
                      found = true;
                      break;
                    }
                  }
                  if (!found) {
                    const option = document.createElement('option');
                    option.value = selected[idx];
                    option.textContent = selected[idx];
                    select.appendChild(option);
                    select.value = selected[idx];
                  }
                }
              });
            }
            
            // Handle Weekly Choices
            // Next Bingwa Challenge
            if (ergosphereData.nextBingwaChallenge) {
              const nextBingwaChallengeSelect = document.getElementById('nextBingwaChallenge');
              let found = false;
              
              for (let i = 0; i < nextBingwaChallengeSelect.options.length; i++) {
                if (nextBingwaChallengeSelect.options[i].value === ergosphereData.nextBingwaChallenge) {
                  nextBingwaChallengeSelect.value = ergosphereData.nextBingwaChallenge;
                  found = true;
                  break;
                }
              }
              
              if (!found && ergosphereData.nextBingwaChallenge) {
                const option = document.createElement('option');
                option.value = ergosphereData.nextBingwaChallenge;
                option.textContent = ergosphereData.nextBingwaChallenge;
                nextBingwaChallengeSelect.appendChild(option);
                nextBingwaChallengeSelect.value = ergosphereData.nextBingwaChallenge;
              }
            }
            
            // Atletico Workout
            if (ergosphereData.atleticoWorkout) {
              const atleticoWorkoutSelect = document.getElementById('atleticoWorkout');
              let found = false;
              
              for (let i = 0; i < atleticoWorkoutSelect.options.length; i++) {
                if (atleticoWorkoutSelect.options[i].value === ergosphereData.atleticoWorkout) {
                  atleticoWorkoutSelect.value = ergosphereData.atleticoWorkout;
                  found = true;
                  break;
                }
              }
              
              if (!found && ergosphereData.atleticoWorkout) {
                const option = document.createElement('option');
                option.value = ergosphereData.atleticoWorkout;
                option.textContent = ergosphereData.atleticoWorkout;
                atleticoWorkoutSelect.appendChild(option);
                atleticoWorkoutSelect.value = ergosphereData.atleticoWorkout;
              }
            }
            
            // Weekly Errand
            if (ergosphereData.weeklyErrand) {
              const weeklyErrandSelect = document.getElementById('weeklyErrand');
              let found = false;
              
              for (let i = 0; i < weeklyErrandSelect.options.length; i++) {
                if (weeklyErrandSelect.options[i].value === ergosphereData.weeklyErrand) {
                  weeklyErrandSelect.value = ergosphereData.weeklyErrand;
                  found = true;
                  break;
                }
              }
              
              if (!found && ergosphereData.weeklyErrand) {
                const option = document.createElement('option');
                option.value = ergosphereData.weeklyErrand;
                option.textContent = ergosphereData.weeklyErrand;
                weeklyErrandSelect.appendChild(option);
                weeklyErrandSelect.value = ergosphereData.weeklyErrand;
              }
            }
            
            // Anime
            if (ergosphereData.anime) {
              const animeSelect = document.getElementById('animeSelection');
              let found = false;
              for (let i = 0; i < animeSelect.options.length; i++) {
                if (animeSelect.options[i].value === ergosphereData.anime) {
                  animeSelect.value = ergosphereData.anime;
                  found = true;
                  break;
                }
              }
              if (!found) {
                const option = document.createElement('option');
                option.value = ergosphereData.anime;
                option.textContent = ergosphereData.anime;
                animeSelect.appendChild(option);
                animeSelect.value = ergosphereData.anime;
              }
            }
            // Sunday Morning
            if (ergosphereData.sundayMorning) {
              const smSelect = document.getElementById('sundayMorningSelection');
              let found = false;
              for (let i = 0; i < smSelect.options.length; i++) {
                if (smSelect.options[i].value === ergosphereData.sundayMorning) {
                  smSelect.value = ergosphereData.sundayMorning;
                  found = true;
                  break;
                }
              }
              if (!found) {
                const option = document.createElement('option');
                option.value = ergosphereData.sundayMorning;
                option.textContent = ergosphereData.sundayMorning;
                smSelect.appendChild(option);
                smSelect.value = ergosphereData.sundayMorning;
              }
            }
            // Sunday Night
            if (ergosphereData.sundayNight) {
              const snSelect = document.getElementById('sundayNightSelection');
              let found = false;
              for (let i = 0; i < snSelect.options.length; i++) {
                if (snSelect.options[i].value === ergosphereData.sundayNight) {
                  snSelect.value = ergosphereData.sundayNight;
                  found = true;
                  break;
                }
              }
              if (!found) {
                const option = document.createElement('option');
                option.value = ergosphereData.sundayNight;
                option.textContent = ergosphereData.sundayNight;
                snSelect.appendChild(option);
                snSelect.value = ergosphereData.sundayNight;
              }
            }

            // Anime date
            if (ergosphereData.animeEndDate) {
              document.getElementById('animeEndDate').value = formatDateForInput(ergosphereData.animeEndDate);
            }
            
            // Sunday Morning date
            if (ergosphereData.sundayMorningEndDate) {
              document.getElementById('sundayMorningEndDate').value = formatDateForInput(ergosphereData.sundayMorningEndDate);
            }
            
            // Sunday Night date
            if (ergosphereData.sundayNightEndDate) {
              document.getElementById('sundayNightEndDate').value = formatDateForInput(ergosphereData.sundayNightEndDate);
            }

            // Update preview
            updatePreview();
            
            // Update last updated time if available
            if (ergosphereData.lastUpdated) {
              const lastUpdated = new Date(ergosphereData.lastUpdated);
              document.getElementById('last-updated').textContent = lastUpdated.toLocaleString();
            }
          })
          .catch(error => {
            console.error('Error loading selections:', error);
            showNotification('Error loading current selections: ' + error.message, 'error');
          });
      }        // Helper to format dates for input fields (YYYY-MM-DD)
      function formatDateForInput(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return '';
        return date.toISOString().split('T')[0];
      }
      
      // Add event listeners for date pickers
      document.getElementById('animeEndDate').addEventListener('change', updatePreview);
      document.getElementById('sundayMorningEndDate').addEventListener('change', updatePreview);
      document.getElementById('sundayNightEndDate').addEventListener('change', updatePreview);
      
      // Format date for preview with weeks remaining
      function formatEndDateForPreview(dateString) {
        if (!dateString) return '';
        
        try {
          const dateObj = new Date(dateString);
          if (isNaN(dateObj.getTime())) return '';
          
          // Format as MM/DD
          const month = String(dateObj.getMonth() + 1).padStart(2, '0');
          const day = String(dateObj.getDate()).padStart(2, '0');
          const formattedDate = `${month}/${day}`;
          
          // Calculate weeks remaining
          const now = new Date();
          const diffTime = dateObj.getTime() - now.getTime();
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          const diffWeeks = Math.ceil(diffDays / 7);
          
          // Format the weeks text
          let weeksText = '';
          if (diffDays <= 0) {
            weeksText = 'Ended';
          } else if (diffWeeks === 1) {
            weeksText = '1 week left';
          } else {
            weeksText = `${diffWeeks} weeks left`;
          }
          
          return `${formattedDate} - ${weeksText}`;
        } catch (error) {
          console.error('Error formatting preview date:', error);
          return '';
        }
      }
      
      function updatePreview() {
        document.getElementById('preview-bingwa').textContent = document.getElementById('bingwaChampion').value;
        document.getElementById('preview-atletico').textContent = document.getElementById('atleticoChamp').value;
        document.getElementById('preview-movie').textContent = document.getElementById('movieNight').value;
        document.getElementById('preview-banquet').textContent = document.getElementById('banquetMeal').value;
        document.getElementById('preview-brunch').textContent = document.getElementById('bingwaBrunch').value;
        
        // Anime with end date
        const animeValue = document.getElementById('animeSelection').value;
        const animeEndDateValue = document.getElementById('animeEndDate').value;
        let animeDisplay = animeValue || 'None selected';
        if (animeValue && animeEndDateValue) {
          const formattedDate = formatEndDateForPreview(animeEndDateValue);
          animeDisplay += ` (${formattedDate})`;
        }
        document.getElementById('preview-anime').textContent = animeDisplay;
        
        // Sunday Morning with end date
        const sundayMorningValue = document.getElementById('sundayMorningSelection').value;
        const sundayMorningEndDateValue = document.getElementById('sundayMorningEndDate').value;
        let sundayMorningDisplay = sundayMorningValue || 'None selected';
        if (sundayMorningValue && sundayMorningEndDateValue) {
          const formattedDate = formatEndDateForPreview(sundayMorningEndDateValue);
          sundayMorningDisplay += ` (${formattedDate})`;
        }
        document.getElementById('preview-sunday-morning').textContent = sundayMorningDisplay;
        
        // Sunday Night with end date
        const sundayNightValue = document.getElementById('sundayNightSelection').value;
        const sundayNightEndDateValue = document.getElementById('sundayNightEndDate').value;
        let sundayNightDisplay = sundayNightValue || 'None selected';
        if (sundayNightValue && sundayNightEndDateValue) {
          const formattedDate = formatEndDateForPreview(sundayNightEndDateValue);
          sundayNightDisplay += ` (${formattedDate})`;
        }
        document.getElementById('preview-sunday-night').textContent = sundayNightDisplay;
        
        // Weekly Choices
        document.getElementById('preview-next-bingwa').textContent = document.getElementById('nextBingwaChallenge').value || 'None selected';
        document.getElementById('preview-atletico-workout').textContent = document.getElementById('atleticoWorkout').value || 'None selected';
        document.getElementById('preview-weekly-errand').textContent = document.getElementById('weeklyErrand').value || 'None selected';
        
        // Quarterly games preview
        document.getElementById('preview-q1game').textContent = document.getElementById('q1Game').value || 'None selected';
        document.getElementById('preview-q2game').textContent = document.getElementById('q2Game').value || 'None selected';
        document.getElementById('preview-q3game').textContent = document.getElementById('q3Game').value || 'None selected';
        document.getElementById('preview-q4game').textContent = document.getElementById('q4Game').value || 'None selected';
        
        // Update ErgoArt subject preview
        document.getElementById('preview-ergoart').textContent = document.getElementById('ergoArtSubject').value || 'None set';
        
        const yt1 = document.getElementById('youtubeTheater1');
        const yt2 = document.getElementById('youtubeTheater2');
        const yt3 = document.getElementById('youtubeTheater3');
        const selected = [yt1, yt2, yt3].map(select => {
          if (select.value) {
            const runtime = select.selectedOptions[0]?.getAttribute('data-runtime') || '';
            return select.value + (runtime ? ` (${runtime})` : '');
          }
          return null;
        }).filter(Boolean);
        document.getElementById('preview-youtube').textContent = selected.length ? selected.join(', ') : 'None';
        // Show total runtime in preview
        let totalSeconds = 0;
        [yt1, yt2, yt3].forEach(select => {
          const runtime = select.selectedOptions[0]?.getAttribute('data-runtime') || '0:00';
          if (select.value) {
            const match = runtime.match(/(\d+):(\d+)/);
            if (match) {
              totalSeconds += parseInt(match[1], 10) * 60 + parseInt(match[2], 10);
            }
          }
        });
        if (selected.length) {
          const mins = Math.floor(totalSeconds / 60);
          const secs = totalSeconds % 60;
          document.getElementById('preview-youtube').textContent += ` (Total: ${mins}:${secs.toString().padStart(2, '0')})`;
        }
      }
      
      function checkYouTubeRuntimeLimit() {
        const yt1 = document.getElementById('youtubeTheater1');
        const yt2 = document.getElementById('youtubeTheater2');
        const yt3 = document.getElementById('youtubeTheater3');
        const warning = document.getElementById('youtube-runtime-warning');
        let totalSeconds = 0;
        [yt1, yt2, yt3].forEach(select => {
          const runtime = select.selectedOptions[0]?.getAttribute('data-runtime') || '0:00';
          if (select.value) {
            const match = runtime.match(/(\d+):(\d+)/);
            if (match) {
              totalSeconds += parseInt(match[1], 10) * 60 + parseInt(match[2], 10);
            }
          }
        });
        if (totalSeconds > 3660) { // 1 hour 1 minute = 3660 seconds
          warning.style.display = 'block';
          warning.textContent = 'Total runtime must be under 1 hour 1 minute (01:01:00). Please remove some selections.';
          return false;
        } else {
          warning.style.display = 'none';
          warning.textContent = '';
          return true;
        }
      }
      
      function updateYouTubeDropdowns() {
        // Prevent duplicate selections
        const yt1 = document.getElementById('youtubeTheater1');
        const yt2 = document.getElementById('youtubeTheater2');
        const yt3 = document.getElementById('youtubeTheater3');
        const selected = [yt1.value, yt2.value, yt3.value].filter(Boolean);
        [yt1, yt2, yt3].forEach((select, idx) => {
          Array.from(select.options).forEach(opt => {
            if (opt.value && selected.includes(opt.value) && select.value !== opt.value) {
              opt.disabled = true;
            } else {
              opt.disabled = false;
            }
          });
        });
      }
      
      function showNotification(message, type) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = 'notification ' + type;
        notification.style.display = 'block';
        
        setTimeout(() => {
          notification.style.display = 'none';
        }, 5000);
      }
    });
  </script>
</body>
</html>
